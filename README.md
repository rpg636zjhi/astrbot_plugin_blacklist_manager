# 黑名单管理插件

## 插件信息

- **插件名称**: blacklist_manager
- **开发者**: rpg636zjhi
- **功能描述**: 黑名单管理插件
- **版本**: 1.0.0

## 功能概述

该插件提供了用户和群组的黑名单管理功能，可以拦截黑名单用户或群组的消息，确保机器人运行环境的安全性和可控性。

## 命令列表

### 用户黑名单管理

| 命令 | 权限 | 参数 | 描述 |
|------|------|------|------|
| `黑名单 add <qq_number>` | ADMIN | qq_number: 要添加到黑名单的QQ号 | 添加用户到黑名单 |
| `黑名单 remove <qq_number>` | ADMIN | qq_number: 要从黑名单移除的QQ号 | 从黑名单移除用户 |
| `黑名单 list` | ADMIN | 无 | 查看用户黑名单列表 |

### 群组黑名单管理

| 命令 | 权限 | 参数 | 描述 |
|------|------|------|------|
| `群黑名单 add <group_number>` | ADMIN | group_number: 要添加到黑名单的群号 | 添加群组到黑名单 |
| `群黑名单 remove <group_number>` | ADMIN | group_number: 要从黑名单移除的群号 | 从黑名单移除群组 |
| `群黑名单 list` | ADMIN | 无 | 查看群组黑名单列表 |

### 统计信息

| 命令 | 权限 | 参数 | 描述 |
|------|------|------|------|
| `黑名单状态` | ADMIN | 无 | 查看黑名单统计信息 |

## 功能特性

### 1. 数据持久化
- 自动保存黑名单数据到 `data/blacklist_data.json` 文件
- 插件启动时自动加载历史黑名单数据
- 插件卸载时自动保存数据

### 2. 权限控制
- 所有黑名单管理命令仅限 ADMIN 权限用户使用
- 防止普通用户滥用黑名单功能

### 3. 实时拦截
- 自动拦截黑名单用户发送的所有消息
- 自动拦截黑名单群组中的所有消息
- 使用 `event.stop_event()` 彻底阻止事件传播

### 4. 输入验证
- 验证 QQ 号和群号必须为纯数字
- 防止重复添加已存在的黑名单条目
- 友好的错误提示信息

## 使用示例

### 添加用户到黑名单
```
黑名单 add 123456789
```
响应: `✅ 已成功将用户 123456789 添加到黑名单`

### 查看用户黑名单
```
黑名单 list
```
响应:
```
📋 用户黑名单列表:
• 123456789
• 987654321
```

### 查看统计信息
```
黑名单状态
```
响应:
```
📊 黑名单统计:
• 用户黑名单: 2 个用户
• 群组黑名单: 1 个群组
```

## 技术实现

### 数据结构
```python
user_blacklist: Set[str]    # 用户黑名单集合
group_blacklist: Set[str]   # 群组黑名单集合
```

### 文件存储
- 位置: `data/blacklist_data.json`
- 格式: JSON
- 编码: UTF-8

### 事件拦截
- 拦截所有来自黑名单用户的消息
- 拦截所有来自黑名单群组的消息
- 使用日志记录拦截行为

## 注意事项

1. **权限要求**: 只有 Bot管理员 权限的用户可以管理黑名单
3. **性能影响**: 黑名单检查会在每条消息上执行，但使用集合查找，性能影响很小
4. **拦截效果**: 被拦截的消息将不会触发任何其他插件的处理

## 更新日志
### v1.1.0
- 增加插件配置
### v1.0.0
- 初始版本发布
- 实现基本的用户和群组黑名单管理
- 添加数据持久化功能
- 实现实时消息拦截